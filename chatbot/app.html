<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>App Â· Chatbot</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body data-page="app">
  <!-- Background -->
  <div class="neural-background">
    <div class="neural-node"></div><div class="neural-node"></div>
    <div class="neural-node"></div><div class="neural-node"></div>
    <div class="neural-node"></div>
  </div>

  <div class="container page-shell" style="max-width:1100px;">
    <!-- Header -->
    <header class="top-bar" style="gap:12px; align-items:center;">
      <div class="row" style="gap:12px; align-items:center;">
        <div class="ai-logo" aria-hidden="true" style="transform:scale(.9)">
          <div class="logo-core">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5"/>
              <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"
                    stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </div>
          <div class="logo-rings">
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
            <div class="ring ring-3"></div>
          </div>
        </div>
        <h1 class="muted" style="margin:0; letter-spacing:.2px;">Your Chatbot</h1>
      </div>

      <nav class="row" style="margin-left:auto; gap:10px;">
        <button id="signOutBtn" class="neural-button signout-big" title="Sign out">
          <div class="button-bg"></div>
          <span class="button-text">Sign out</span>
          <div class="button-glow"></div>
        </button>
      </nav>
    </header>

    <!-- Welcome -->
    <section class="info-card glass-card section-block">
      <div class="row" style="justify-content:space-between; align-items:center; gap:12px;">
        <div>
          <h2 style="margin:0 0 4px 0;">Welcome <span class="wave" aria-hidden="true">ðŸ‘‹</span></h2>
          <p class="muted" style="margin:0">Youâ€™re successfully signed in.</p>
        </div>
      </div>
    </section>

    <!-- Two-column layout -->
    <div class="grid two section-grid">
      <!-- Account -->
      <section class="info-card glass-card">
        <strong id="accountTitle">Account</strong>
        <div class="muted" style="margin-top:10px;">Email: <span id="userEmail">(loadingâ€¦)</span></div>
        <!-- Keep UID element hidden so JS wonâ€™t break -->
        <div style="display:none;">UID: <span id="userUid"></span></div>

        <div class="spacer" style="height:12px;"></div>

        <!-- Load AI + Progress bar grouped -->
        <div class="row" style="gap:12px; align-items:center; flex-wrap:wrap;">
          <button id="loadModelBtn" class="neural-button" style="min-height:42px;" title="Download and initialize the on-device model">
            <div class="button-bg"></div>
            <span class="button-text">Load AI</span>
            <div class="button-glow"></div>
          </button>

          <div class="progress-wrap" style="min-width:260px; flex:1; max-width:600px;">
            <!-- Progress first -->
            <div class="progress" role="progressbar" aria-label="Model download progress"
                 aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-describedby="initProgress">
              <div id="modelProgressFill" class="progress-fill" style="width:0%"></div>
            </div>
            <!-- Label underneath -->
            <div id="initProgress" class="progress-label muted" aria-live="polite"
                 style="font-size:12px; margin:6px 0 0;">
              Model: not loaded
            </div>
          </div>
        </div>

        <p class="muted" style="font-size:12px; line-height:1.4; margin:12px 0 0;">
          Tip: After loading, press <kbd>Enter</kbd> to send, or <kbd>Shift</kbd>+<kbd>Enter</kbd> for a new line.
        </p>
      </section>

      <!-- Chat -->
      <section class="info-card glass-card" aria-labelledby="chatTitle" style="display:flex; flex-direction:column;">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <strong id="chatTitle">Chatbot</strong>
        </div>

        <!-- Chat history -->
        <div id="chatLog" aria-live="polite" aria-label="Chat history"
             style="margin-top:12px; height:clamp(260px, 40vh, 420px); overflow:auto; padding:12px; border-radius:16px; background:rgba(255,255,255,.03); box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);">
        </div>

        <!-- Composer (textarea full width ABOVE send button) -->
        <div class="stack" style="margin-top:12px; gap:10px;">
          <label for="chatInput" class="visually-hidden">Message</label>
          <textarea id="chatInput" rows="3" placeholder="Type your messageâ€¦"
            style="width:100%; resize:vertical; border-radius:14px; padding:12px; background:rgba(255,255,255,.05); color:inherit; border:0; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08)"></textarea>

          <div class="row" style="justify-content:flex-end;">
            <button id="sendMsgBtn" class="neural-button" style="min-width:140px; min-height:46px;" title="Send message">
              <div class="button-bg"></div>
              <span class="button-text">Send</span>
              <div class="button-glow"></div>
            </button>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="stack" style="gap:10px; margin-top:28px;">
      <div class="muted" style="font-size:12px; text-align:center;">
        Need to switch accounts? Use the Sign Out button above.
      </div>
    </footer>
  </div>

  <!-- Progress helpers -->
  <script>
    // Public helper: update progress 0..100, or null for indeterminate
    window.updateModelProgress = function(pct, label) {
      const bar = document.getElementById('modelProgressFill');
      const wrap = bar?.parentElement;
      const txt = document.getElementById('initProgress');
      if (!bar || !wrap) return;

      if (pct == null) {
        wrap.classList.add('indeterminate');
        wrap.setAttribute('aria-valuenow', '0');
        bar.style.width = '40%';
      } else {
        wrap.classList.remove('indeterminate');
        const clamped = Math.max(0, Math.min(100, pct|0));
        wrap.setAttribute('aria-valuenow', String(clamped));
        bar.style.width = clamped + '%';
      }
      if (txt && label) txt.textContent = label;
    };

    // Mirror any "NN%" text written into #initProgress
    (function mirrorTextPercent() {
      const txt = document.getElementById('initProgress');
      const m = new MutationObserver(() => {
        const t = txt.textContent || '';
        const m2 = t.match(/(\d{1,3})\s*%/);
        if (m2) window.updateModelProgress(parseInt(m2[1],10));
      });
      txt && m.observe(txt, { childList:true, subtree:true, characterData:true });
    })();

    // Immediate visual feedback on click
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('loadModelBtn')?.addEventListener('click', () => {
        window.updateModelProgress(null, 'Preparing modelâ€¦');
      }, { capture: true });
    });
  </script>

  <script type="module" src="script.js"></script>

  <!-- Local overrides -->
  <style>
    /* Ensure the page always scrolls at 100% zoom */
    html, body { height: auto !important; min-height: 100%; overflow-y: auto !important; }
    body { overscroll-behavior-y: contain; }

    /* Roomy layout */
    .page-shell { padding-top: 20px; padding-bottom: 56px; }
    .section-block { margin-top: 16px; margin-bottom: 22px; }
    .section-grid { gap: 28px !important; margin-top: 8px; margin-bottom: 12px; }

    /* Glass cards */
    .glass-card {
      border: 0 !important;
      border-radius: 22px !important;
      background: rgba(255,255,255,0.06) !important;
      box-shadow:
        0 10px 30px rgba(0,0,0,.25),
        inset 0 0 0 1px rgba(255,255,255,.08);
      backdrop-filter: blur(10px) saturate(130%);
      -webkit-backdrop-filter: blur(10px) saturate(130%);
      padding: 16px 16px 18px;
    }

    /* BIGGER Sign out button */
    .signout-big { 
      min-width: 160px; 
      min-height: 50px; 
      padding: 10px 18px; 
      font-size: 16px; 
      font-weight: 600;
      border-radius: 16px !important;
    }

    /* Glass buttons */
    .neural-button { background: transparent !important; border-radius: 14px !important; }
    .neural-button .button-bg {
      background: rgba(255,255,255,0.06) !important;
      border: 0 !important;
      box-shadow:
        0 6px 18px rgba(0,0,0,.25),
        inset 0 0 0 1px rgba(255,255,255,.10);
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      border-radius: 14px !important;
    }
    .neural-button .button-text { color: rgba(255,255,255,0.95) !important; }
    .neural-button:hover .button-bg {
      background: rgba(255,255,255,0.12) !important;
      transform: translateY(-1px);
      box-shadow:
        0 10px 22px rgba(0,0,0,.28),
        inset 0 0 0 1px rgba(255,255,255,.16);
    }
    .neural-button:active .button-bg {
      transform: translateY(0);
      box-shadow:
        0 6px 16px rgba(0,0,0,.22),
        inset 0 0 0 1px rgba(255,255,255,.12);
    }
    .neural-button .button-glow { opacity: .35; }

    /* Progress bar */
    .progress {
      position: relative;
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 0;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      border-radius: 999px;
      background:
        linear-gradient( to bottom, rgba(255,255,255,0.75), rgba(255,255,255,0.35) ),
        linear-gradient( to right, rgba(120,180,255,0.45), rgba(160,120,255,0.45) );
      box-shadow: inset 0 0 12px rgba(255,255,255,.35);
      transition: width .25s ease;
    }
    .progress.indeterminate .progress-fill {
      position: relative;
      width: 40%;
      animation: indet 1.2s linear infinite;
      background:
        repeating-linear-gradient( 45deg, rgba(255,255,255,0.35) 0 10px, rgba(255,255,255,0.15) 10px 20px ),
        linear-gradient( to right, rgba(120,180,255,0.35), rgba(160,120,255,0.35) );
    }
    @keyframes indet {
      0% { transform: translateX(-60%); }
      100% { transform: translateX(160%); }
    }

    /* Responsive tweaks */
    @media (max-width: 880px) {
      #chatLog { height: clamp(220px, 38vh, 360px); }
      .section-grid { gap: 22px !important; }
      .signout-big { min-width: 140px; min-height: 48px; }
    }

    /* a11y helper */
    .visually-hidden {
      position:absolute !important;
      height:1px; width:1px;
      overflow:hidden; clip:rect(1px,1px,1px,1px);
      white-space:nowrap; border:0; padding:0; margin:-1px;
    }
  </style>
</body>
</html>
